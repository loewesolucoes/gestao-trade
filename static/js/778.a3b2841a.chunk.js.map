{"version":3,"file":"static/js/778.a3b2841a.chunk.js","mappings":"mBAKO,MAAMA,EAOX,YAAcC,GACZD,EAAeE,cAAcC,UAAaC,IACxCJ,EAAeK,WAAWC,SAAQC,GAAKA,EAAEH,IAAO,EAGlDJ,EAAeE,cAAcM,eAAkBJ,IAC7CK,QAAQC,MAAM,gCAAiCN,EAAM,EAGvDJ,EAAeW,iBAAiBR,UAAaC,IAC3C,MAAM,GAAEQ,GAAOR,EAAMS,KACfC,EAASC,KAAKC,eAAeJ,GAErB,MAAVE,GAOJA,EAAOV,UACAW,KAAKC,eAAeJ,IANzBH,QAAQC,MAAM,qBAAsBE,EAAIR,EAMZ,EAGhCJ,EAAeW,iBAAiBH,eAAkBJ,IAChDK,QAAQC,MAAM,gCAAiCN,EAAM,CAEzD,CAEAa,WAAAA,CAAoBC,GAAqB,KAArBA,WAAAA,EAAkB,KA/B9BC,UAAY,CA+BsB,CAE1C,mBAAcC,CAAaN,GACzBC,KAAKV,WAAWgB,KAAKP,EACvB,CAEA,kBAAcQ,CAAYlB,GACxBJ,EAAeW,iBAAiBY,YAAYnB,EAAMS,KACpD,CAEA,UAAaW,CAAKC,EAAaC,GAC7B,MAAMC,EAAM,MAAAC,OAASb,KAAKG,WAAU,UAAAU,OAASb,KAAKI,aAElD,OAAO,IAAIU,SAAQ,CAACC,EAASC,KAC3B/B,EAAegB,eAAeW,GAAUvB,IACtCK,QAAQuB,MAAM,2BAA4B5B,EAAMS,KAAKD,GAAIe,EAAQvB,GAE7DA,EAAMS,KAAKD,KAAOe,IAChBvB,EAAMS,KAAKH,MACbqB,EAAO3B,EAAMS,MAEbiB,EAAQ1B,EAAMS,KAAKoB,SACvB,EAGFxB,QAAQuB,MAAM,yBAA0B,OAAQL,EAAQF,EAAKC,GAE7D1B,EAAeE,cAAcqB,YAAY,CACvCX,GAAIe,EACJb,OAAQ,OACRW,IAAKA,EACLC,OAAQA,GACR,GAEN,CAEA,YAAaQ,GACX,MAAMP,EAAM,MAAAC,OAASb,KAAKG,WAAU,YAAAU,OAAWb,KAAKI,aAEpD,OAAO,IAAIU,SAAQ,CAACC,EAASC,KAC3B/B,EAAegB,eAAeW,GAAUvB,IACtCK,QAAQuB,MAAM,2BAA4B5B,EAAMS,KAAKD,GAAIe,EAAQvB,GAE7DA,EAAMS,KAAKD,KAAOe,IAChBvB,EAAMS,KAAKH,MACbqB,EAAO3B,EAAMS,MAEbiB,EAAQ1B,EAAMS,KAAKsB,QACvB,EAGF1B,QAAQuB,MAAM,yBAA0B,SAAUL,GAElD3B,EAAeE,cAAcqB,YAAY,CACvCX,GAAIe,EACJb,OAAQ,UACR,GAEN,CAEA,UAAasB,CAAKvB,GAChB,MAAM,IAAIwB,MAAM,0BAClB,EAlGWrC,EACaE,cAAkC,IAAIoC,iBAJ3C,gCAGRtC,EAEaW,iBAAqC,IAAI2B,iBAJ3C,mCAEXtC,EAGaK,WAAgD,GAH7DL,EAIagB,eAAmE,CAAC,EAiG9FhB,EAAeC,QCvGfQ,QAAQuB,MAAM,mCAEd,MAAMO,EAAS,IAAIC,OAAyE,GAAAZ,OAAiCa,gBAAsB,wBAGnJzC,EAAeoB,cAAahB,IAC1BK,QAAQuB,MAAM,kCAAmC5B,GAEjDmC,EAAOhB,YAAYnB,EAAMS,KAAK,IAKhC0B,EAAOG,QAAUC,GAAKlC,QAAQC,MAAM,0BAA2BiC,GAC/DJ,EAAOpC,UAAaC,IAAW,IAADwC,EAC5BnC,QAAQuB,MAAM,+BAAgC5B,GAE7B,QAAjBwC,EAAIxC,EAAMS,KAAKD,UAAE,IAAAgC,GAAbA,EAAeC,WAAW,OAC5B7C,EAAesB,YAAYlB,GAE3B0C,KAAKvB,YAAYnB,EAAMS,KACzB,EAGFiC,KAAK3C,UAAaC,IAChBK,QAAQuB,MAAM,qBAAsB5B,GAEpCmC,EAAOhB,YAAYnB,EAAMS,KAAK,EAGhCJ,QAAQuB,MAAM,gC","sources":["workers/worker-database.ts","workers/database-broadcast.ts"],"sourcesContent":["import { IDatabase } from \"../repositories/database\";\r\n\r\nconst DB_CHANNEL_SEND = `gestao-database-channel-send`;\r\nconst DB_CHANNEL_RECEIVE = `gestao-database-channel-receive`;\r\n\r\nexport class WorkerDatabase implements IDatabase {\r\n  private static readonly broadcastSend: BroadcastChannel = new BroadcastChannel(DB_CHANNEL_SEND);\r\n  private static readonly broadcastReceive: BroadcastChannel = new BroadcastChannel(DB_CHANNEL_RECEIVE);\r\n  private static readonly onMessages: ((event: MessageEvent) => void)[] = [];\r\n  private static readonly onExecMessages: { [key: string]: (event: MessageEvent) => void } = {};\r\n  private currentId = 0;\r\n\r\n  public static _init() {\r\n    WorkerDatabase.broadcastSend.onmessage = (event) => {\r\n      WorkerDatabase.onMessages.forEach(x => x(event));\r\n    }\r\n\r\n    WorkerDatabase.broadcastSend.onmessageerror = (event) => {\r\n      console.error('WorkerDatabase.onmessageerror', event);\r\n    }\r\n\r\n    WorkerDatabase.broadcastReceive.onmessage = (event) => {\r\n      const { id } = event.data;\r\n      const action = this.onExecMessages[id];\r\n\r\n      if (action == null) {\r\n        // se estiver dando erro nessa parte deve ser devido a possuir duas tabs abertas\r\n        console.error('invalid message id', id, event);\r\n\r\n        return;\r\n      }\r\n\r\n      action(event);\r\n      delete this.onExecMessages[id];\r\n    }\r\n\r\n    WorkerDatabase.broadcastReceive.onmessageerror = (event) => {\r\n      console.error('WorkerDatabase.onmessageerror', event);\r\n    }\r\n  }\r\n\r\n  constructor(private workerName: string) { }\r\n\r\n  public static setOnMessage(action: (e: MessageEvent) => void) {\r\n    this.onMessages.push(action);\r\n  }\r\n\r\n  public static postReceive(event: MessageEvent) {\r\n    WorkerDatabase.broadcastReceive.postMessage(event.data);\r\n  }\r\n\r\n  public async exec(sql: string, params?: any): Promise<initSqlJs.QueryExecResult[]> {\r\n    const nextId = `sw-${this.workerName}-exec-${this.currentId++}`;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      WorkerDatabase.onExecMessages[nextId] = event => {\r\n        console.debug('WorkerDatabase.onmessage', event.data.id, nextId, event);\r\n\r\n        if (event.data.id === nextId) {\r\n          if (event.data.error)\r\n            reject(event.data);\r\n          else\r\n            resolve(event.data.results);\r\n        }\r\n      };\r\n\r\n      console.debug('WorkerDatabase.sending', 'exec', nextId, sql, params);\r\n\r\n      WorkerDatabase.broadcastSend.postMessage({\r\n        id: nextId,\r\n        action: \"exec\",\r\n        sql: sql,\r\n        params: params\r\n      });\r\n    });\r\n  }\r\n\r\n  public async export(): Promise<Uint8Array> {\r\n    const nextId = `sw-${this.workerName}-export-${this.currentId++}`;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      WorkerDatabase.onExecMessages[nextId] = event => {\r\n        console.debug('WorkerDatabase.onmessage', event.data.id, nextId, event);\r\n\r\n        if (event.data.id === nextId) {\r\n          if (event.data.error)\r\n            reject(event.data);\r\n          else\r\n            resolve(event.data.buffer);\r\n        }\r\n      };\r\n\r\n      console.debug('WorkerDatabase.sending', 'export', nextId);\r\n\r\n      WorkerDatabase.broadcastSend.postMessage({\r\n        id: nextId,\r\n        action: \"export\",\r\n      });\r\n    });\r\n  }\r\n\r\n  public async open(data?: Buffer | ArrayLike<number> | null | undefined): Promise<any> {\r\n    throw new Error(\"Method not implemented.\");\r\n  }\r\n}\r\n\r\nWorkerDatabase._init();","import { GestaoMessage } from \"./common\";\r\nimport { WorkerDatabase } from \"./worker-database\";\r\n\r\nconsole.debug('database-broadcast-worker start');\r\n\r\nconst worker = new Worker(process.env.NODE_ENV === 'development' ? `${process.env.PUBLIC_URL}/worker.sql-wasm-debug.js` : `${process.env.PUBLIC_URL}/worker.sql-wasm.js`);\r\n// const worker = new Worker((new URL(\"sql.js/dist/worker.sql-wasm.js\", import.meta.url)));\r\n\r\nWorkerDatabase.setOnMessage(event => {\r\n  console.debug('database-broadcast.setOnMessage', event);\r\n\r\n  worker.postMessage(event.data);\r\n})\r\n\r\n/* eslint-disable no-restricted-globals */\r\n\r\nworker.onerror = e => console.error(\"Database worker error: \", e);\r\nworker.onmessage = (event) => {\r\n  console.debug('database-broadcast.onmessage', event);\r\n\r\n  if (event.data.id?.startsWith('sw-')) {\r\n    WorkerDatabase.postReceive(event);\r\n  } else {\r\n    self.postMessage(event.data);\r\n  }\r\n}\r\n\r\nself.onmessage = (event: MessageEvent<GestaoMessage>) => {\r\n  console.debug('database.onmessage', event);\r\n\r\n  worker.postMessage(event.data);\r\n};\r\n\r\nconsole.debug('database-broadcast-worker end');\r\n\r\nexport { };\r\n"],"names":["WorkerDatabase","_init","broadcastSend","onmessage","event","onMessages","forEach","x","onmessageerror","console","error","broadcastReceive","id","data","action","this","onExecMessages","constructor","workerName","currentId","setOnMessage","push","postReceive","postMessage","exec","sql","params","nextId","concat","Promise","resolve","reject","debug","results","export","buffer","open","Error","BroadcastChannel","worker","Worker","process","onerror","e","_event$data$id","startsWith","self"],"sourceRoot":""}