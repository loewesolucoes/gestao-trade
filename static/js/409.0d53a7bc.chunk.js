(()=>{"use strict";var e={409:(e,t,a)=>{let s=function(e){return e.LOAD_ALL="loadAll",e.CONNECT="connect",e}({});const o=crypto.randomUUID(),r="gestao-database-channel-send-".concat(o),n="gestao-database-channel-receive-".concat(o);var c=a(45),i=a(178),d=a.n(i),l=a(423),u=a.n(l),h=a(382);class m{constructor(){this.currentId=0,this.worker=void 0,this.onMessages={},this.worker=new Worker(new URL(a.p+a.u(151),a.b)),this.worker.onerror=e=>console.log("Worker error: ",e),this.worker.onmessage=e=>{const{id:t}=e.data,a=this.onMessages[t];if(null==a)throw console.error("invalid message id",t,e),new Error("invalid message id => ".concat(t));a(e),delete this.onMessages[t]}}async exec(e,t){const a="exec-".concat(this.currentId++);return new Promise(((s,o)=>{this.onMessages[a]=e=>{console.debug("DatabaseConnector.onmessage",e.data.id,a,e),e.data.id===a&&(e.data.error?o(e.data):s(e.data.results))},console.debug("DatabaseConnector.sending","exec",a,e,t),this.worker.postMessage({id:a,action:"exec",sql:e,params:t})}))}async export(){const e="export-".concat(this.currentId++);return new Promise(((t,a)=>{this.onMessages[e]=s=>{console.debug("DatabaseConnector.onmessage",s.data.id,e,s),s.data.id===e&&(s.data.error?a(s.data):t(s.data.buffer))},console.debug("DatabaseConnector.sending","export",e),this.worker.postMessage({id:e,action:"export"})}))}async open(e){const t="open-".concat(this.currentId++);return new Promise(((a,s)=>{this.onMessages[t]=e=>{console.debug("DatabaseConnector.onmessage",e.data.id,t,e),e.data.id===t&&(e.data.error?s(e.data):a(e.data))},console.debug("DatabaseConnector.sending","open",t),this.worker.postMessage({id:t,action:"open",buffer:e})}))}}const p="base64";class E{static async create(e){const t=await E.exportLocalDump();null==e&&null!=t&&(e=h.hp.from(t,p));const a=new m;await a.open(e);const s=new b(a);return await s.runMigrations(),s}static async persistLocalDump(e){await u().setItem(E.DB_NAME,e||"")}static async exportLocalDump(){return await u().getItem(E.DB_NAME)}static generateDumpFromExport(e){return h.hp.from(e).toString(p)}}E.DB_NAME="gestao-trade.settings.db";let g=function(e){return e[e.DATE=0]="DATE",e[e.DATE_TIME=1]="DATE_TIME",e[e.NUMBER=2]="NUMBER",e[e.BOOLEAN=3]="BOOLEAN",e[e.IGNORE=4]="IGNORE",e}({}),w=function(e){return e.ACOES="acoes",e.PARAMETROS="parametros",e}({});const T="runned";class b{constructor(e){this.db=e,this.DEFAULT_MAPPING={createdDate:g.DATE_TIME,updatedDate:g.DATE_TIME,monthYear:g.IGNORE}}async saveAll(e,t){let a={},s="";t.forEach(((t,o)=>{let r={};r=null==t.id?this.createInsertCommand(e,t,"".concat(o)):this.createUpdateCommand(e,t,"".concat(o));const{command:n,params:c}=r;s="".concat(s,";").concat(n),a={...a,...c}})),console.debug("saveAll",s,a),this.db.exec(s,a),await this.persistDb()}async save(e,t){let a={};return a=null!=(null===t||void 0===t?void 0:t.id)?await this.update(e,t):await this.insert(e,t),await this.persistDb(),a}async delete(e,t){return await this.db.exec("delete from ".concat(e," where id = $id"),{$id:t}),await this.persistDb(),{}}async list(e){await Promise.resolve();const t=await this.db.exec("SELECT * FROM ".concat(e," order by createdDate desc"));if(!Array.isArray(t))throw new Error("".concat(e," n\xe3o encontrado (a)"));return this.parseSqlResultToObj(t,this.DEFAULT_MAPPING)[0]||[]}async get(e,t){await Promise.resolve();const a=await this.db.exec("select * from ".concat(e," where id = $id"),{$id:t});if(0===a.length)throw new Error("".concat(e," n\xe3o encontrado (a)"));return this.parseSqlResultToObj(a,this.DEFAULT_MAPPING)[0][0]}async insert(e,t){const{command:a,params:s,nextData:o}=this.createInsertCommand(e,t),r="".concat(a,";SELECT LAST_INSERT_ROWID();"),n=await this.db.exec(r,s);return o.id=n[0].values[0][0],o}createInsertCommand(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const s={...t,createdDate:new Date},{keys:o,params:r}=this.parseToCommand(s,a);return{command:"INSERT INTO ".concat(e," (").concat(o.join(", "),") VALUES (").concat(o.map((e=>"$".concat(e).concat(a))).join(", "),")"),params:r,nextData:s}}async update(e,t){const{command:a,params:s}=this.createUpdateCommand(e,t);return await this.db.exec(a,s),this.get(e,t.id)}createUpdateCommand(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const s={...t,updatedDate:new Date},{keys:o,params:r}=this.parseToCommand(s,a);return{command:"UPDATE ".concat(e," SET ").concat(o.map((e=>"".concat(e,"=$").concat(e).concat(a))).join(", ")," WHERE id=$id").concat(a),params:r,nextData:s}}parseSqlResultToObj(e,t){return e.map((e=>e.values.map((a=>e.columns.reduce(((e,s,o)=>{const r=a[o];let n=!0;return"id"!==s&&null!=r&&(null!=t&&(t[s]===g.DATE?(e[s]=d()(r,"YYYY-MM-DD").toDate(),n=!1):t[s]===g.DATE_TIME?(e[s]=d()(r,"YYYY-MM-DD hh:mm:ss").toDate(),n=!1):t[s]===g.NUMBER?(e[s]=r,n=!1):t[s]===g.BOOLEAN?(e[s]=!!r,n=!1):t[s]===g.IGNORE&&(n=!1)),n&&"number"===typeof r&&(e[s]=(0,c.A)(r),n=!1)),n&&(e[s]=r),e}),{})))))}parseToCommand(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const a=Object.keys(e).filter((t=>void 0!==e[t])),s=a.reduce(((a,s)=>{var o,r;let n=null!==(o=e[s])&&void 0!==o?o:null;return n instanceof Date&&(n=d()(n).format()),null!==(r=n)&&void 0!==r&&r._isBigNumber&&(n=n.toNumber()),a["$".concat(s).concat(t)]=n,a}),{});return{keys:a,params:s}}async runMigrations(){await Promise.resolve(),await this.db.exec('CREATE TABLE IF NOT EXISTS "migrations" ("id" INTEGER NOT NULL,"name" TEXT NULL DEFAULT NULL,"executedDate" DATETIME NULL,PRIMARY KEY ("id"));');const e=await this.db.exec('select * from "migrations"'),t=(this.parseSqlResultToObj(e)[0]||[]).reduce(((e,t)=>(e[t.name]=t,e)),{});null==t.parametros&&(await this.db.exec('CREATE TABLE IF NOT EXISTS "parametros" ("id" INTEGER NOT NULL,"chave" TEXT NOT NULL,"valor" TEXT NULL, "createdDate" DATETIME NOT NULL, "updatedDate" DATETIME NULL DEFAULT NULL,PRIMARY KEY ("id"));'),t.parametros=T),null==t.acoes&&(await this.db.exec('CREATE TABLE IF NOT EXISTS "acoes" ("id" INTEGER NOT NULL,"nome" TEXT NOT NULL,"logo" TEXT NULL,"codigo" TEXT NULL, "tipo" INTEGER NULL, "active" INTEGER NULL, "valorDeMercado" REAL NULL, "setor" TEXT NULL, "createdDate" DATETIME NOT NULL, "updatedDate" DATETIME NULL DEFAULT NULL,PRIMARY KEY ("id"));'),t.acoes=T),null==t.desativar_acoes&&(await this.db.exec('UPDATE acoes SET "active" = 0 WHERE 1 = 1;'),t.desativar_acoes=T);const a=Object.keys(t).filter((e=>t[e]===T)).reduce(((e,t)=>(e.push({name:t,executedDate:new Date}),e)),[]);let s={},o="";a.length>0&&(a.forEach(((e,t)=>{const{keys:a,params:r}=this.parseToCommand(e,"".concat(t)),n='INSERT INTO "migrations" ('.concat(a.join(", "),") VALUES (").concat(a.map((e=>"$".concat(e).concat(t))).join(", "),")");o="".concat(o,";").concat(n),s={...s,...r}})),await this.db.exec(o,s)),await this.persistDb()}async exportOriginalDump(){return await this.db.export()}async persistDb(){const e=await this.exportDump();await E.persistLocalDump(e),console.debug("persistDb ok")}async exportDump(){await Promise.resolve();const e=await this.db.export();return await E.generateDumpFromExport(e)}beforeClose(){window.addEventListener("beforeunload",(e=>{const t="Ter certeza que deseja sair?",a=e||window.event;return a&&(a.returnValue=t),this.persistDb(),t}))}}const D="BRAPI_API_KEY";console.debug("yahoo-worker start");const v="YAHOO_LAST_UPDATE",A=new class{constructor(e){this.broadcastSend=new BroadcastChannel(r),this.broadcastReceive=new BroadcastChannel(n),this.broadcastConnect=new BroadcastChannel("DB_BROADCAST_CHANNEL_SW"),this.onMessages=[],this.onExecMessages={},this.workerName=void 0,this.currentId=0,this.workerName="sw-".concat(e),this.broadcastReceive.onmessage=e=>{const{id:t}=e.data,a=this.onExecMessages[t];if(null==a)throw console.debug("invalid message id",t,e),new Error("invalid message id");a(e),delete this.onExecMessages[t]},this.broadcastReceive.onmessageerror=e=>{console.error("WorkerDatabaseConnector.onmessageerror",e)},this.broadcastConnect.postMessage({id:"connect",swName:this.workerName,sendChannel:r,receiveChannel:n})}setOnMessage(e){this.onMessages.push(e)}postReceive(e){this.broadcastReceive.postMessage(e.data)}async exec(e,t){const a="".concat(this.workerName,":exec-").concat(this.currentId++);return new Promise(((s,o)=>{this.onExecMessages[a]=e=>{console.debug("WorkerDatabaseConnector.onmessage",e.data.id,a,e),e.data.id===a&&(e.data.error?o(e.data):s(e.data.results))},console.debug("WorkerDatabaseConnector.sending","exec",a,e,t),this.broadcastSend.postMessage({id:a,action:"exec",sql:e,params:t})}))}async export(){const e="".concat(this.workerName,":export-").concat(this.currentId++);return new Promise(((t,a)=>{this.onExecMessages[e]=s=>{console.debug("WorkerDatabaseConnector.onmessage",s.data.id,e,s),s.data.id===e&&(s.data.error?a(s.data):t(s.data.buffer))},console.debug("WorkerDatabaseConnector.sending","export",e),this.broadcastSend.postMessage({id:e,action:"export"})}))}async open(e){throw new Error("Method not implemented.")}}("yahoo"),L=(new class extends b{constructor(){super(...arguments),this.HISTORICO_ACOES_MAPPING={...this.DEFAULT_MAPPING}}}(A),new class extends b{constructor(){super(...arguments),this._paramsDict=void 0}async getDict(){return null==this._paramsDict&&(this._paramsDict=await this.loadParamsOrDefault()),this._paramsDict}async loadParamsOrDefault(){const e=(await this.list(w.PARAMETROS)).reduce(((e,t)=>(e[t.chave]=t,e)),{}),t=e;t[D]=e[D]||{chave:D,valor:""};const a=Object.keys(t).map((e=>t[e])).filter((e=>null==e.id));return await Promise.all(a.map((e=>this.save(w.PARAMETROS,e)))),t}async getByKey(e){return(await this.getDict())[e]}async getValorByKey(e){var t;return null===(t=(await this.getDict())[e])||void 0===t?void 0:t.valor}async set(e,t){let a=(await this.getDict())[e];null==a&&(a={});const s=await this.save(w.PARAMETROS,{...a,chave:e,valor:t});return delete this._paramsDict,s}}(A));self.onmessage=e=>{if(console.debug("yahoo.onmessage",e),e.data.action===s.LOAD_ALL)!async function(e){const t=await L.getByKey(v),a=d()(null===t||void 0===t?void 0:t.valor);d()(new Date).add(-14,"days").isSameOrAfter(a);{console.debug("calling yahoo");const e=await fetch("https://query1.finance.yahoo.com/v7/finance/download/PETR3.SA?period1=-2208988800&period2=1720569600&interval=1d&events=history"),t=await e.text();console.log(t),console.debug("end calling yahoo")}self.postMessage({id:e.id,response:{success:!0}})}(e.data)},console.debug("yahoo-worker end")}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=e,a.x=()=>{var e=a.O(void 0,[846,924],(()=>a(409)));return e=a.O(e)},(()=>{var e=[];a.O=(t,s,o,r)=>{if(!s){var n=1/0;for(l=0;l<e.length;l++){s=e[l][0],o=e[l][1],r=e[l][2];for(var c=!0,i=0;i<s.length;i++)(!1&r||n>=r)&&Object.keys(a.O).every((e=>a.O[e](s[i])))?s.splice(i--,1):(c=!1,r<n&&(n=r));if(c){e.splice(l--,1);var d=o();void 0!==d&&(t=d)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[s,o,r]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,s)=>(a.f[s](e,t),t)),[])),a.u=e=>"static/js/"+e+"."+{151:"d3f9119b",846:"ffe85a79",924:"8fb96675"}[e]+".chunk.js",a.miniCssF=e=>{},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="/gestao-trade/",(()=>{a.b=self.location+"/../../../";var e={409:1};a.f.i=(t,s)=>{e[t]||importScripts(a.p+a.u(t))};var t=self.webpackChunkgestao_trade=self.webpackChunkgestao_trade||[],s=t.push.bind(t);t.push=t=>{var o=t[0],r=t[1],n=t[2];for(var c in r)a.o(r,c)&&(a.m[c]=r[c]);for(n&&n(a);o.length;)e[o.pop()]=1;s(t)}})(),(()=>{var e=a.x;a.x=()=>Promise.all([a.e(846),a.e(924)]).then(e)})();a.x()})();
//# sourceMappingURL=409.0d53a7bc.chunk.js.map