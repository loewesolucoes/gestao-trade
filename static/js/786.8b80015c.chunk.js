"use strict";(self.webpackChunkgestao_trade=self.webpackChunkgestao_trade||[]).push([[786],{157:(e,o,t)=>{t.d(o,{p:()=>l});var i=t(45),a=t(178),n=t.n(a),s=t(579);function l(e){const{onChange:o,isNumber:t,groupSymbolLeft:a,groupSymbolRight:l,isPercent:r,value:u,...d}=e,c="number"===e.type||t,m="date"===e.type,v="month"===e.type,h="textarea"===e.type;function f(e){const{value:t}=e.target,a=o||function(){};a(r?(0,i.A)(t).div(100):c?(0,i.A)(t):m?n()(t,"YYYY-MM-DD").toDate():v?n()(t,"YYYY-MM").toDate():t)}const b=function(e,o,t,i,a){return o?function(e,o){let{isPercent:t}=o;return null==e||isNaN(e.toNumber())?"":t?e.times(100).toNumber():e.toNumber()}(e,{isPercent:a}):t?n()(e).format("YYYY-MM-DD"):i?n()(e).format("YYYY-MM"):e||""}(u,c,m,v,r),p=h?(0,s.jsx)("textarea",{className:"form-control",onChange:f,value:b,...d}):(0,s.jsx)("input",{className:"form-control",onChange:f,value:b,...d});return a||l?(0,s.jsxs)("div",{className:"input-group mb-3",children:[a&&(0,s.jsx)("span",{className:"input-group-text",children:a}),p,l&&(0,s.jsx)("span",{className:"input-group-text",children:l})]}):p}},964:(e,o,t)=>{t.d(o,{l:()=>s});var i=t(642);class a{static keyFromValue(e,o){return Object.keys(e)[Object.values(e).indexOf(o)]}static values(e){return Object.keys(e).filter((e=>isNaN(e)))}}var n=t(579);function s(e){const{acao:o,isActive:t,onClick:s}=e;return(0,n.jsxs)("button",{type:"button",className:"stock-card ".concat(t?"marked":""," ").concat(o.active?"active":"").trim(),onClick:()=>s(o),children:[(0,n.jsx)("img",{src:o.logo,alt:o.nome}),(0,n.jsx)("h4",{children:o.nome}),(0,n.jsx)("small",{children:o.codigo}),(0,n.jsxs)("div",{className:"info",children:[o.setor&&(0,n.jsx)("span",{children:o.setor}),o.tipo&&(0,n.jsx)("span",{children:a.keyFromValue(i.t,o.tipo)})]})]})}},786:(e,o,t)=>{t.r(o),t.d(o,{default:()=>Y});var i=t(415),a=t(43),n=t(401),s=t(964),l=t(547),r=t(178),u=t.n(r),d=t(579);let c;const m=e=>{const{data:o,analysis:t,visibleFrom:i,visibleTo:n,options:s,...r}=e,m=(0,a.useRef)();function h(){null!=c&&(m.current.innerHTML=""),function(){c=(0,l.R9)(m.current,{width:m.current.clientWidth,height:500,layout:{textColor:"rgba(0, 0, 0, 0.9)"},grid:{vertLines:{color:"rgba(197, 203, 206, 0.5)"},horzLines:{color:"rgba(197, 203, 206, 0.5)"}},crosshair:{mode:l._q.Normal},rightPriceScale:{borderColor:"rgba(197, 203, 206, 0.8)"},timeScale:{borderColor:"rgba(197, 203, 206, 0.8)"}});c.addCandlestickSeries({}).setData(o)}(),b()}function f(){c.applyOptions({width:m.current.clientWidth})}function b(){null==i||null==n?c.timeScale().fitContent():c.timeScale().setVisibleRange({from:u()(i).unix(),to:u()(n).unix()})}return(0,a.useEffect)((()=>{if(null!=o)return h(),window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f),c.remove()}}),[o]),(0,a.useEffect)((()=>{h(),s.showFibo&&function(){for(let e=0;e<t.length;e++){const o=t[e],i=v();c.addLineSeries({color:i,lineStyle:l.Sc.Solid,lastValueVisible:!1,priceLineVisible:!1}).setData([{time:u()(o.dataInicio).format("YYYY-MM-DD"),value:o.fibo0},{time:u()(o.dataFim).format("YYYY-MM-DD"),value:o.fibo0}]);c.addLineSeries({color:i,lineStyle:l.Sc.Dashed,lastValueVisible:!1,priceLineVisible:!1}).setData([{time:u()(o.dataInicio).format("YYYY-MM-DD"),value:o.fibo382},{time:u()(o.dataFim).format("YYYY-MM-DD"),value:o.fibo382}]);c.addLineSeries({color:i,lineStyle:l.Sc.Dashed,lastValueVisible:!1,priceLineVisible:!1}).setData([{time:u()(o.dataInicio).format("YYYY-MM-DD"),value:o.fibo618},{time:u()(o.dataFim).format("YYYY-MM-DD"),value:o.fibo618}]);c.addLineSeries({color:i,lineStyle:l.Sc.Dotted,lastValueVisible:!1,priceLineVisible:!1}).setData([{time:u()(o.dataInicio).format("YYYY-MM-DD"),value:o.fibo50},{time:u()(o.dataFim).format("YYYY-MM-DD"),value:o.fibo50}]);c.addLineSeries({color:i,lineStyle:l.Sc.Solid,lastValueVisible:!1,priceLineVisible:!1}).setData([{time:u()(o.dataInicio).format("YYYY-MM-DD"),value:o.fibo1000},{time:u()(o.dataFim).format("YYYY-MM-DD"),value:o.fibo1000}])}}(),s.showMovements&&function(){for(let e=0;e<t.length;e++){const o=t[e],i=v();c.addLineSeries({color:i,lineStyle:l.Sc.Dashed,lastValueVisible:!1,priceLineVisible:!1}).setData(o.movements.map((e=>{var o,t,i;return{time:u()(e.date).format("YYYY-MM-DD"),value:null===(o=e.low)||void 0===o||null===(t=o.plus(null===(i=e.high)||void 0===i?void 0:i.minus(e.low).div(2)))||void 0===t?void 0:t.toNumber()}})))}}()}),[s]),(0,a.useEffect)((()=>{b()}),[i,n]),(0,d.jsx)("div",{ref:m,...r})};function v(){for(var e="#",o=0;o<6;o++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}let h=function(e){return e.SUBIDA="SUBIDA",e.DESCIDA="DESCIDA",e.UNCOMPLETED="UNCOMPLETED",e}({}),f=function(e){return e.TOPO="TOPO",e.FUNDO="FUNDO",e}({}),b=function(e){return e.ALTA="ALTA",e.BAIXA="BAIXA",e}({});const p=new class{run(e,o,t){if(0===e.length)return[];const i=e.filter((e=>u()(e.date).isBetween(o,t))),a=this.toposEFundos(i,2),n=this.parseToMovementsTresPontos(a,b.ALTA),s=this.parseToMovementsTresPontos(a,b.BAIXA),l=this.criarFiboEAlvos(n),r=this.criarFiboEAlvos(s);return l.concat(r)}criarFiboEAlvos(e){var o;const t=(null===(o=e[e.length-1])||void 0===o?void 0:o.movements)||[],i=t[t.length-1];return e.map((e=>{const o={...e},t=o.movements[0],a=o.movements[o.movements.length-1],n=a.high.minus(t.low);return o.dataInicio=t.date,o.dataFim=a.date,o.type===h.DESCIDA?(o.fibo0=t.high,o.fibo382=t.high.minus(n.times(.382)),o.fibo618=t.high.minus(n.times(.618)),o.fibo50=t.high.minus(n.times(.5)),o.fibo1000=a.low,o.alvo1=o.fibo618.minus(o.fibo0).div(.618).plus(o.fibo618),o.bateuAlvo1=i.low.isLessThanOrEqualTo(o.alvo1),o.alvo2=o.fibo50.minus(o.fibo0).div(.5).plus(o.fibo1000),o.bateuAlvo2=i.low.isLessThanOrEqualTo(o.alvo2),o.alvo3=o.fibo382.minus(o.fibo0).div(.382).plus(o.alvo1),o.bateuAlvo3=i.low.isLessThanOrEqualTo(o.alvo3)):(o.fibo0=t.low,o.fibo382=t.low.plus(n.times(.382)),o.fibo618=t.low.plus(n.times(.618)),o.fibo50=t.low.plus(n.times(.5)),o.fibo1000=a.high,o.alvo1=o.fibo618.minus(o.fibo0).div(.618).plus(o.fibo618),o.bateuAlvo1=i.high.isGreaterThanOrEqualTo(o.alvo1),o.alvo2=o.fibo50.minus(o.fibo0).div(.5).plus(o.fibo1000),o.bateuAlvo2=i.high.isGreaterThanOrEqualTo(o.alvo2),o.alvo3=o.fibo382.minus(o.fibo0).div(.382).plus(o.alvo1),o.bateuAlvo3=i.high.isGreaterThanOrEqualTo(o.alvo3)),o}))}parseToMovementsTresPontos(e,o){return e.reduce(((e,t)=>{const i=e[e.length-1];if(null==i)s();else if(1===i.movements.length)i.movements.push(t.data),1===e.length&&(o===b.ALTA&&t.type==f.FUNDO&&s(),o===b.BAIXA&&t.type==f.TOPO&&s());else{var a,n;const e=i.movements[0];i.movements.push(t.data),o===b.BAIXA?i.movementType=null!==(a=e.high)&&void 0!==a&&a.isLessThanOrEqualTo(t.data.high)?h.SUBIDA:h.DESCIDA:i.movementType=null!==(n=e.low)&&void 0!==n&&n.isLessThanOrEqualTo(t.data.low)?h.SUBIDA:h.DESCIDA,s()}return e;function s(){e.push({index:t.index,order:t.order,movements:[t.data],movementType:h.UNCOMPLETED})}}),[])}parseToMovementsDoisPontos(e){return e.reduce(((e,o)=>{const t=e[e.length-1];if(null==t)e.push({index:o.index,order:o.order,movements:[o.data],movementType:h.UNCOMPLETED});else{const i=t.movements[t.movements.length-1];i.min<=o.data.min?e.push({index:t.index,order:t.order,movements:[i,o.data],movementType:h.SUBIDA}):e.push({index:t.index,order:t.order,movements:[i,o.data],movementType:h.DESCIDA})}return e}),[])}toposEFundos(e,o){const t=this.extremos(e,o);return t.topos.concat(t.fundos).sort(((e,o)=>e.index<o.index?-1:e.index>o.index?1:0)).reduce(((e,o)=>{const t=e[e.length-1];return(null===t||void 0===t?void 0:t.type)!=o.type&&e.push(o),e}),[])}extremos(e,o){const t=[],i=[];for(let a=0;a<e.length;a++)this.ehTopo(e,a,o)&&t.push({index:a,order:a-o,date:e[a].date,data:{...e[a],type:f.TOPO},type:f.TOPO}),this.ehFundo(e,a,o)&&i.push({index:a,order:a-o,date:e[a].date,data:{...e[a],type:f.FUNDO},type:f.FUNDO});return{topos:t,fundos:i}}ehTopo(e,o,t){var i=!0,a=e[o].high;for(let s=1;s<t+1;s++){var n;const t=null===(n=e[o+s])||void 0===n?void 0:n.high,l=null===a||void 0===a?void 0:a.isLessThanOrEqualTo(t);if(null==t||l){i=!1;break}}return i}ehFundo(e,o,t){var i=!0,a=e[o].low;for(let s=1;s<t+1;s++){var n;const t=null===(n=e[o+s])||void 0===n?void 0:n.low,l=null===a||void 0===a?void 0:a.isGreaterThanOrEqualTo(t);if(null==t||l){i=!1;break}}return i}};var D=t(157),g=t(32);function Y(){const{isMobile:e}=(0,g.D)(),{isDbOk:o,repository:t}=(0,n.r)(),l=e?-1:-3,[r,c]=(0,a.useState)(u()().add(l,"months").format("YYYY-MM-DD")),[v,h]=(0,a.useState)(u()().format("YYYY-MM-DD")),[f,b]=(0,a.useState)(),[Y,N]=(0,a.useState)(),[M,T]=(0,a.useState)(),[y,S]=(0,a.useState)(),[A,E]=(0,a.useState)(!1),[j,w]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{document.title="In\xedcio | ".concat("Gest\xe3o de trading")}),[]),(0,a.useEffect)((()=>{o&&async function(){const e=await t.acoes.listActives();b(e)}()}),[o]),(0,a.useEffect)((()=>{o&&async function(){if(T(void 0),null==Y)return;const e=await t.historicoAcoes.listByCode(Y);T(e.map((e=>{var o,t,i,a;return{time:u()(e.date).format("YYYY-MM-DD"),open:null===(o=e.open)||void 0===o?void 0:o.toNumber(),close:null===(t=e.close)||void 0===t?void 0:t.toNumber(),high:null===(i=e.high)||void 0===i?void 0:i.toNumber(),low:null===(a=e.low)||void 0===a?void 0:a.toNumber()}})));const o=p.run(e,r,v);S(o.filter((e=>"UNCOMPLETED"!==e.movementType)).map((e=>{var o,t,i,a,n,s,l,r;return{...e,alvo1:null===(o=e.alvo1)||void 0===o?void 0:o.toNumber(),alvo2:null===(t=e.alvo2)||void 0===t?void 0:t.toNumber(),alvo3:null===(i=e.alvo3)||void 0===i?void 0:i.toNumber(),fibo0:null===(a=e.fibo0)||void 0===a?void 0:a.toNumber(),fibo382:null===(n=e.fibo382)||void 0===n?void 0:n.toNumber(),fibo618:null===(s=e.fibo618)||void 0===s?void 0:s.toNumber(),fibo50:null===(l=e.fibo50)||void 0===l?void 0:l.toNumber(),fibo1000:null===(r=e.fibo1000)||void 0===r?void 0:r.toNumber()}})))}()}),[o,Y]),(0,d.jsx)(i.P,{children:(0,d.jsxs)("section",{className:"container",children:[(0,d.jsx)("div",{className:"stocks",children:null==f?(0,d.jsx)("div",{className:"alert alert-info",children:"Carregando a\xe7\xf5es ativas..."}):0===f.length?(0,d.jsx)("div",{className:"alert alert-info",children:"Nenhuma a\xe7\xe3o ativa..."}):f.map((e=>(0,d.jsx)(s.l,{acao:e,isActive:e.codigo===Y,onClick:e=>N(e.codigo)},e.codigo)))}),(0,d.jsxs)("div",{className:"configs my-3 gap-3 d-flex flex-column flex-lg-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"dataInicio",className:"form-label",children:"Data inicio:"}),(0,d.jsx)(D.p,{type:"date",id:"dataInicio",name:"dataInicio",className:"form-control",value:r,onChange:e=>c(e)})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"dataFim",className:"form-label",children:"Data fim:"}),(0,d.jsx)(D.p,{type:"date",id:"dataFim",name:"dataFim",className:"form-control",value:v,onChange:e=>h(e)})]}),(0,d.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>E(!A),children:"Mostrar Fibo"}),(0,d.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>w(!j),children:"Mostrar Movimentos"})]}),null==Y?(0,d.jsx)("div",{className:"alert alert-warning",children:"Escolha uma a\xe7\xe3o para analisar"}):(0,d.jsxs)(d.Fragment,{children:[null==M?(0,d.jsx)("div",{className:"alert alert-info",children:"Carregando hist\xf3rico..."}):(0,d.jsx)(m,{className:"chart",data:M,visibleFrom:r,visibleTo:v,analysis:y,options:{showFibo:A,showMovements:j}}),(0,d.jsxs)("section",{className:"card analysis",children:[(0,d.jsx)("div",{className:"card-header",children:"Analise"}),(0,d.jsx)("div",{className:"card-body",children:null==y?(0,d.jsx)("div",{className:"alert alert-info",children:"Carregando analises..."}):(0,d.jsx)("div",{style:{whiteSpace:"pre",maxHeight:300,overflow:"auto"},children:x(y)})})]})]})]})})}function x(e){return JSON.stringify(e.map((e=>({...e,movements:void 0}))),null,4)}}}]);
//# sourceMappingURL=786.8b80015c.chunk.js.map