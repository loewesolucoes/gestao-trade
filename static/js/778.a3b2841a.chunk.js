(()=>{"use strict";class e{static _init(){e.broadcastSend.onmessage=s=>{e.onMessages.forEach((e=>e(s)))},e.broadcastSend.onmessageerror=e=>{console.error("WorkerDatabase.onmessageerror",e)},e.broadcastReceive.onmessage=e=>{const{id:s}=e.data,a=this.onExecMessages[s];null!=a?(a(e),delete this.onExecMessages[s]):console.error("invalid message id",s,e)},e.broadcastReceive.onmessageerror=e=>{console.error("WorkerDatabase.onmessageerror",e)}}constructor(e){this.workerName=e,this.currentId=0}static setOnMessage(e){this.onMessages.push(e)}static postReceive(s){e.broadcastReceive.postMessage(s.data)}async exec(s,a){const o="sw-".concat(this.workerName,"-exec-").concat(this.currentId++);return new Promise(((t,r)=>{e.onExecMessages[o]=e=>{console.debug("WorkerDatabase.onmessage",e.data.id,o,e),e.data.id===o&&(e.data.error?r(e.data):t(e.data.results))},console.debug("WorkerDatabase.sending","exec",o,s,a),e.broadcastSend.postMessage({id:o,action:"exec",sql:s,params:a})}))}async export(){const s="sw-".concat(this.workerName,"-export-").concat(this.currentId++);return new Promise(((a,o)=>{e.onExecMessages[s]=e=>{console.debug("WorkerDatabase.onmessage",e.data.id,s,e),e.data.id===s&&(e.data.error?o(e.data):a(e.data.buffer))},console.debug("WorkerDatabase.sending","export",s),e.broadcastSend.postMessage({id:s,action:"export"})}))}async open(e){throw new Error("Method not implemented.")}}e.broadcastSend=new BroadcastChannel("gestao-database-channel-send"),e.broadcastReceive=new BroadcastChannel("gestao-database-channel-receive"),e.onMessages=[],e.onExecMessages={},e._init(),console.debug("database-broadcast-worker start");const s=new Worker("".concat("/gestao-trade","/worker.sql-wasm.js"));e.setOnMessage((e=>{console.debug("database-broadcast.setOnMessage",e),s.postMessage(e.data)})),s.onerror=e=>console.error("Database worker error: ",e),s.onmessage=s=>{var a;console.debug("database-broadcast.onmessage",s),null!==(a=s.data.id)&&void 0!==a&&a.startsWith("sw-")?e.postReceive(s):self.postMessage(s.data)},self.onmessage=e=>{console.debug("database.onmessage",e),s.postMessage(e.data)},console.debug("database-broadcast-worker end")})();
//# sourceMappingURL=778.a3b2841a.chunk.js.map